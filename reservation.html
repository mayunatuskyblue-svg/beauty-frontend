<!doctype html>
<html lang="ja">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>予約の確認</title>
<link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:wght@500;600&family=Playfair+Display:wght@500;600&display=swap" rel="stylesheet">

<!-- Google Apps Script WebApp URL をここに（なければ URL 引数 ?gas=...&key=... を使用） -->
<meta name="bl-sheet-hook" content="">
<style>
/* Elegant timetable typography */
#hpWeekTitle{font-family:'Playfair Display','Shippori Mincho',serif;font-weight:600;letter-spacing:.02em}
#hpGrid th{font-family:'Playfair Display','Bodoni Moda',serif;font-weight:600;letter-spacing:.02em}
#hpGrid th:first-child{font-weight:600}
#hpGrid td .timebtn{font-family:'Bodoni Moda','Playfair Display',serif;font-weight:600;letter-spacing:.01em}

:root{--base:#F7F1E1;--ink:#2E1A16;--stroke:#eadfca;--teal:#246A73;--muted:#6f5a54}
*{box-sizing:border-box}
body{margin:0;background:var(--base);color:var(--ink);font-family:"Inter","Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
.container{max-width:980px;margin:20px auto;padding:0 16px}
.card{background:#fff;border:1px solid var(--stroke);border-radius:16px;box-shadow:0 10px 24px rgba(36,106,115,.08);padding:16px;margin:10px 0}
h1{font-size:26px;margin:6px 0 10px}
.row{display:grid;grid-template-columns:160px 1fr;gap:6px 14px}
dt{color:var(--muted);font-size:13px}
dd{margin:0 0 6px 0}
input[type="email"]{height:40px;border-radius:12px;border:1px solid var(--stroke);padding:0 12px;width:100%}
.btn{height:44px;border-radius:999px;padding:0 18px;font-weight:800;cursor:pointer;border:1px solid transparent}
.btn.primary{background:var(--teal);color:#fff;border-color:var(--teal);box-shadow:0 6px 16px rgba(36,106,115,.18)}
.btn.ghost{background:#fff;border-color:var(--stroke)}
.toolbar{display:flex;gap:10px;align-items:center;margin:12px 0;flex-wrap:wrap}
#msg{white-space:pre-line}
footer{margin:12px 0 30px;color:var(--muted);font-size:12px}
/* weekly timetable */
/* disabled slot */
.timebtn[aria-disabled="true"]{
  color:#bbb; border-color:#eee; background:#f7f7f7;
  cursor:not-allowed; box-shadow:none;
}
#hpGridWrap{max-width:860px;margin:16px auto;background:#fff;border:1px solid var(--stroke);border-radius:14px;box-shadow:0 10px 24px rgba(49,14,16,.08);padding:14px 16px}
#hpGrid{overflow:auto}
#hpGrid table{width:auto;border-collapse:separate;border-spacing:0;display:table;margin:0 auto}
#hpGrid th,#hpGrid td{border-bottom:1px solid var(--stroke);border-right:1px solid var(--stroke)}
#hpGrid th{background:#fff;font-weight:700}
#hpGrid td{padding:6px 4px;text-align:center;vertical-align:middle}
.timebtn{display:inline-grid;place-items:center;width:36px;height:28px;border-radius:8px;border:1px solid var(--stroke);background:#fff;cursor:pointer}
.timebtn:hover{box-shadow:0 6px 14px rgba(0,0,0,.08)}
.headerbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.headerbar .btn{height:36px;padding:0 12px;font-weight:700}
.small{font-size:12px;color:var(--muted)}
  /* === modal (footer links) === */
#blModal::backdrop{ background: rgba(0,0,0,.35); }
#blModal{
  border:none; padding:0; width: min(920px, 92vw); height: min(80vh, 720px);
  border-radius:16px; overflow:hidden; box-shadow: 0 20px 50px rgba(0,0,0,.25);
}
#blModal header{
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 14px; background:#fff; border-bottom:1px solid var(--stroke);
  font-weight:800;
}
#blModal header .title{ font-size:14px }
#blModal button.close{
  border:none; background:#fff; cursor:pointer; font-weight:800; padding:6px 10px; border-radius:10px;
}
#blModal iframe{ width:100%; height: calc(100% - 48px); border:0; display:block; background:#fff }

</style>
  <script src="lang.js" defer></script>
<script>document.addEventListener('DOMContentLoaded',()=>BL_I18N.i18nApply());</script>
  <style>
/* --- BeautyLanka UI Booster (non-breaking) --- */
:root{
  --base:#F7F1E1; --ink:#2E1A16; --stroke:#eadfca; --teal:#246A73; --muted:#6f5a54; --blue:#0A66FF;
  --accent-1:#8AD5CD; --accent-2:#F9C6B8; --accent-3:#E9D7A5; --accent-4:#B6E3FF;
  --glass-bg:rgba(255,255,255,.72); --glass-brd:rgba(0,0,0,.06);
}
body{background:var(--base);color:var(--ink)}
/* 背景の装飾（描画のみ。レイアウトに影響なし） */
.bg-radials:before,.bg-radials:after{content:"";position:fixed;inset:auto;z-index:-2;pointer-events:none;filter:blur(40px);opacity:.38}
.bg-radials:before{left:-120px;top:-120px;width:420px;height:420px;background:
  radial-gradient(120px 120px at 40% 40%, var(--accent-1), transparent 70%),
  radial-gradient(160px 160px at 70% 60%, var(--accent-2), transparent 72%)}
.bg-radials:after{right:-120px;bottom:-120px;width:460px;height:460px;background:
  radial-gradient(140px 140px at 30% 40%, var(--accent-4), transparent 70%),
  radial-gradient(180px 180px at 70% 60%, var(--accent-3), transparent 72%)}
.grain{position:fixed;inset:0;z-index:-1;pointer-events:none;opacity:.07;mix-blend-mode:multiply;
  background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="140" height="140" viewBox="0 0 140 140"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/><feColorMatrix type="saturate" values="0"/><feComponentTransfer><feFuncA type="table" tableValues="0 0 0 .55 .15 0"/></feComponentTransfer></filter><rect width="100%" height="100%" filter="url(%23n)"/></svg>');
  background-size:160px 160px}

/* ボタン/入力：既存 .btn や button に上書き“しすぎない”控えめ装飾 */
.btn, button, a.btn, input[type="button"].btn, input[type="submit"].btn{
  display:inline-flex;align-items:center;justify-content:center;gap:.4em;
  height:40px;border-radius:12px;border:1px solid var(--stroke);
  background:#fff;padding:0 12px;font-weight:800;cursor:pointer;
  box-shadow:0 6px 14px rgba(0,0,0,.06); transition:.15s ease-in-out;
}
.btn.primary{background:var(--teal);border-color:var(--teal);color:#fff;box-shadow:0 10px 24px rgba(36,106,115,.18)}
.btn:hover{transform:translateY(-1px)}
/* カード風の箱（既存の .card があるページはそちら優先。無いページ用の汎用クラス） */
.bl-card{background:#fff;border:1px solid var(--stroke);border-radius:16px;box-shadow:0 12px 28px rgba(0,0,0,.08);padding:16px}

/* 入力類の小綺麗化（既存の幅やIDは触らない） */
input[type="text"],input[type="email"],input[type="tel"],input[type="password"],select,textarea{
  border:1px solid var(--stroke);border-radius:12px;padding:10px 12px;background:#fff;font:inherit
}
input:focus,select:focus,textarea:focus{outline:none;border-color:color-mix(in oklab,var(--teal) 55%,white);
  box-shadow:0 0 0 3px color-mix(in oklab,var(--teal) 20%, transparent)}

/* テーブルの視認性（ゼブラは .zebra を付けた時だけ有効） */
table.zebra tbody tr:nth-child(even){background:#faf6ef}
table.zebra th, table.zebra td{border-bottom:1px solid var(--stroke)}

/* 小さめのタグチップ（表示用。機能なし） */
.tag{padding:6px 10px;border-radius:999px;border:1px solid var(--stroke);font-size:12px;background:#fff}

/* ステップ風パンくず（必要なページだけHTMLを足せば見栄えUP） */
.bl-steps{display:flex;gap:8px;align-items:center;color:var(--muted);font-weight:700}
.bl-steps .dot{width:8px;height:8px;border-radius:50%;background:var(--teal);opacity:.35}
.bl-steps .on{opacity:1}
</style>

</head>
<body>
<div class="container">
  <a href="index.html" class="btn ghost" data-i18n="ui.back">← 戻る</a>
  <h1 data-i18n="reserve.title">予約の確認</h1>
  <div class="bl-steps" aria-hidden="true" style="margin:6px 0 10px">
  <span>1. 検索</span><span class="dot"></span>
  <span class="on">2. 予約内容</span><span class="dot"></span>
  <span>3. 支払い</span>
</div>


  <div class="card">
    <dl class="row">
      <dt data-i18n="reserve.salon">サロン</dt><dd id="v_salon">-</dd>
      <dt data-i18n="reserve.menu">メニュー</dt><dd id="v_menu">-</dd>
      <dt data-i18n="reserve.staff">施術者</dt><dd id="v_staff">-</dd>
      <dt data-i18n="reserve.datetime">日時</dt><dd id="v_date">-</dd>
      <dt data-i18n="reserve.estimate">目安金額</dt><dd id="v_price">-</dd>
    </dl>
  </div>

  <div class="card">
    <label data-i18n="reserve.contactEmail">予約連絡用メール</label>
    <input id="email" type="email" data-i18n-ph="ui.email" placeholder="you@example.com"/>
    <p class="small" data-i18n="reserve.note">※空でも予約はできます。メールを入れると <code>bookings</code> シートに反映されます。</p>
  </div>

  <div class="card" id="hpGridWrap">
    <h2 data-i18n="reserve.select_dt" style="margin:0 0 8px;font-size:18px">Select date &amp; time</h2>
    <div class="headerbar">
      <button id="hpPrev" class="btn ghost" type="button" data-i18n="reserve.prev">‹ Prev</button>
      <div id="hpWeekTitle" style="font-weight:800"></div>
      <button id="hpNext" class="btn ghost" type="button" data-i18n="reserve.next">Next ›</button>
    </div>
    <div id="hpGrid"></div>
    <div class="small" data-i18n="reserve.legend">◯ Available　× Unavailable</div>
  </div>

  <div class="toolbar">
    <button id="btnConfirm" class="btn primary" data-i18n="reserve.submit">この内容で予約する</button>
    <button id="btnCancel" class="btn ghost" onclick="history.back()" data-i18n="reserve.backOnce">一度戻る</button>
    <span id="spin" style="display:none" data-i18n="reserve.process">処理中…</span>
  </div>

  <div id="msg"></div>

  <footer>
    <a href="terms.html">Terms</a> ・ <a href="privacy.html">Privacy</a> ・ <a href="cancel_policy.html">Cancel Policy</a> ・ <a href="contact.html">Contact</a>
 <!-- Footer Modal -->
<dialog id="blModal">
  <header>
    <span class="title">Loading…</span>
    <button class="close" type="button" aria-label="Close">✕</button>
  </header>
  <iframe id="blModalFrame" src="about:blank" loading="lazy"></iframe>
</dialog>

  </footer>
</div>

<script>
// ===== 通貨ユーティリティ（price_jpy を元に表示） =====
const RATES = { JPY:1, USD:0.0067, EUR:0.0061, LKR:2.05 }; // 必要に応じて更新
function getLang(){ try{ return (localStorage.getItem('lang')||'auto')==='ja' ? 'ja' : 'en'; }catch(e){ return 'en'; } }
function getCurrency(){ try{ return localStorage.getItem('bl_currency') || 'JPY'; }catch(e){ return 'JPY'; } }
function fmtCurrencyFromJPY(jpy, cur){
  const n = Math.max(0, Number(jpy)||0);
  const converted = Math.round(n * (RATES[cur] || 1));
  try{
    return new Intl.NumberFormat(getLang()==='ja'?'ja-JP':'en-US',
      { style:'currency', currency: cur, maximumFractionDigits:0 }).format(converted);
  }catch(e){
    const symbols = {JPY:'¥', USD:'$', EUR:'€', LKR:'Rs '};
    return (symbols[cur]||'') + converted.toLocaleString();
  }
}

// ===== URL パラメータから表示を構成 =====
const p = new URLSearchParams(location.search);
const salonId   = p.get('salonId') || p.get('salon') || '';
const salonName = p.get('salonName') || p.get('salon_name') || 'Salon';
const itemName  = p.get('item') || p.get('menu') || 'Menu';
const staffName = p.get('staffName') || p.get('staff') || '指名なし';
const dateTextParam  = p.get('date') || p.get('dt') || '';
const priceJPY  = Number(p.get('price_jpy') || 0);

document.getElementById('v_salon').textContent = salonName || salonId || '-';
document.getElementById('v_menu').textContent  = itemName;
document.getElementById('v_staff').textContent = staffName || '指名なし';
document.getElementById('v_date').textContent  = dateTextParam || '-';
document.getElementById('v_price').textContent = priceJPY ? fmtCurrencyFromJPY(priceJPY, getCurrency()) : '-';

// ===== GAS 設定（meta / localStorage / URL の順で解決） =====
const GAS_URL = document.querySelector('meta[name=bl-sheet-hook]')?.content || p.get('gas') || '';
const GAS_KEY = p.get('key') || localStorage.getItem('bl_gas_key') || '';

// ===== シート反映（bookings 追記） =====
async function recordBookingToSheet({ bookingId, email }){
  if(!GAS_URL){ console.warn('GAS_URL not set'); return; }
  const res = await fetch(GAS_URL, {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({
      key: GAS_KEY,
      kind: 'booking_create',
      bookingId,
      email
    })
  });
  const j = await res.json().catch(()=>({}));
  if(!j || !j.ok) throw new Error((j&&j.error)||'booking_create failed');
}

// ===== UI 操作 =====
function setMsg(t, isErr=false){ const el=document.getElementById('msg'); el.textContent=t||''; el.style.color=isErr?'#74070E':'#2E1A16'; }
function uid(n=8){ const s='23456789ABCDEFGHJKLMNPQRSTUVWXYZ'; return Array.from(crypto.getRandomValues(new Uint8Array(n))).map(b=>s[b%s.length]).join(''); }


document.getElementById('btnConfirm').addEventListener('click', async ()=>{
  const email = (document.getElementById('email').value||'').trim();
  const dtIso = localStorage.getItem('reserve_selected') || '';
  const dateText = dtIso ? new Date(dtIso).toLocaleString() : (dateTextParam || '');
  if(dateText) document.getElementById('v_date').textContent = dateText;

  // 予約ID（元の仕様を踏襲）
  const bid = [salonId||'S', (dateText||'').replace(/[^0-9]/g,''), uid(4)].filter(Boolean).join('-');

  document.getElementById('btnConfirm').disabled = true;
  document.getElementById('spin').style.display = 'inline';
  setMsg('');

  try{
    // 既存のシート反映処理はそのまま
    // 既存：シート反映
await recordBookingToSheet({ bookingId: bid, email });

// --- ここから追記：WhatsApp 通知（ユーザー＆サロン） ---
try {
  const payBase   = 'https://api.beautylk.com';            // あなたのAPIベース
  const adminToken= 'bl_admin_dev_......';                 // server側と同じ ADMIN_TOKEN

  // 送信先（電話は E.164 形式で保存しておくのが理想）
  const userPhone  = (localStorage.getItem('bl_user_phone')  || '').trim(); // 例: +81xxxxxxxxxx
  const salonPhone = (localStorage.getItem('bl_salon_phone') || '').trim();
  const toUser  = userPhone  ? `whatsapp:${userPhone}`  : '';
  const toSalon = salonPhone ? `whatsapp:${salonPhone}` : '';

  // 予約サマリ（画面から拾う）
  const salon   = document.getElementById('v_salon')?.textContent?.trim() || '';
  const menu    = document.getElementById('v_menu')?.textContent?.trim()  || '';
  const staff   = document.getElementById('v_staff')?.textContent?.trim() || '';
  const when    = document.getElementById('v_date')?.textContent?.trim()  || '';
  const price   = document.getElementById('v_price')?.textContent?.trim() || '';

  const makeText = (isSalon=false)=>[
    isSalon ? '【新規予約（サロン向け）】' : 'ご予約ありがとうございます！',
    `予約ID: ${bid}`,
    `サロン: ${salon}`,
    `メニュー: ${menu}`,
    `施術者: ${staff||'—'}`,
    `日時: ${when}`,
    `目安金額: ${price}`,
    isSalon ? '' : '※ご変更はサイトのマイページから承ります。'
  ].filter(Boolean).join('\n');

  const notify = async (to, text)=>{
    if(!to) return;
    await fetch(`${payBase}/api/notify-whatsapp`, {
      method:'POST',
      headers:{'content-type':'application/json','x-admin-token':adminToken},
      body: JSON.stringify({ to, text })
    }).catch(()=>{});
  };

  await Promise.all([
    notify(toUser,  makeText(false)),
    notify(toSalon, makeText(true))
  ]);
} catch(e) { /* 通知失敗は握りつぶしでOK */ }
// --- ここまで追記 ---
    if(email) try{ localStorage.setItem('bl_email', email); }catch(e){}
    setMsg('予約を受け付けました。ご来店をお待ちしています！\n予約ID: '+bid);

  }catch(e){
    setMsg('予約は完了しましたが、シート反映に失敗しました。後で自動再送します。\n'+(e.message||e), true);

  }finally{
    document.getElementById('btnConfirm').disabled = false;
    document.getElementById('spin').style.display = 'none';

    // 追記：カード登録画面に渡す最低限の情報を保存して遷移
    const payload = {
      email: (document.getElementById('email').value||'').trim(),
      salon:  document.getElementById('v_salon')?.textContent?.trim() || '',
      menu:   document.getElementById('v_menu')?.textContent?.trim()  || '',
      staff:  document.getElementById('v_staff')?.textContent?.trim() || '',
      date:   document.getElementById('v_date')?.textContent?.trim()  || dateText || '',
      price:  document.getElementById('v_price')?.textContent?.trim() || '',
      bookingId: bid || ''
    };
    try { sessionStorage.setItem('pendingReservation', JSON.stringify(payload)); } catch(_e) {}

    // カード情報登録ページへ
    window.location.href = 'card_save.html';
  }
});
</script>



  <script>

(function(){
  const grid = document.getElementById('hpGrid');
  const title = document.getElementById('hpWeekTitle');
  const btnPrev = document.getElementById('hpPrev');
  const btnNext = document.getElementById('hpNext');
  const startHour = 9, endHour = 18, stepMin = 30;
// 予約済みタイムスロットを取得（実装がまだ無い場合は空セットを返す）
// ymd = '2025-09-22' / hhmm = '09:30'
async function fetchTakenSlots(salonId, ymd){
  // ▼バックエンドと繋ぐまでは空（＝全部 ◯）
  return new Set();

  // 例）GASに作った /?kind=taken&salonId=S1&ymd=2025-09-22 を叩く想定
  // const url = `${GAS_URL}?key=${encodeURIComponent(GAS_KEY)}&kind=taken&salonId=${encodeURIComponent(salonId)}&ymd=${encodeURIComponent(ymd)}`;
  // const j = await fetch(url).then(r=>r.json()).catch(()=>({ok:false,items:[]}));
  // if(!j.ok) return new Set();
  // return new Set(j.items); // ["09:00","09:30",...]
}
  // === 予約済みスロットの取得（GAS 連動） ===
function getGasUrlAndKey(){
  const p = new URLSearchParams(location.search);
  const url = document.querySelector('meta[name="bl-sheet-hook"]')?.content || p.get('gas') || '';
  const key = p.get('key') || localStorage.getItem('bl_gas_key') || '';
  return { url, key };
}

function hhmm(h,m){ return String(h).padStart(2,'0')+':'+String(m).padStart(2,'0'); }
function ymdOf(d){ return d.toISOString().slice(0,10); }

function fmtYmd(d){ return d.toISOString().slice(0,10); }
function hhmmOf(h,m){ return String(h).padStart(2,'0')+':'+String(m).padStart(2,'0'); }

  let weekOffset = 0;

  function addDays(d, n){ const x=new Date(d); x.setDate(x.getDate()+n); return x; }
  function getWeekStart(d){ const dt = new Date(d); const day=(dt.getDay()+6)%7; dt.setDate(dt.getDate()-day); dt.setHours(0,0,0,0); return dt; }
  function fmtHm(h,m){ return String(h).padStart(2,'0')+':'+String(m).padStart(2,'0'); }

  async function buildWeek(offset){
    const today = new Date();
    const ws = getWeekStart(addDays(today, offset*7));
    const we = addDays(ws, 6);
    title.textContent = ws.toLocaleDateString(undefined,{year:'numeric',month:'long',day:'numeric'}) + ' — ' + we.toLocaleDateString(undefined,{month:'long',day:'numeric'});

    const times=[];
    for(let h=startHour; h<=endHour; h++){
      for(let m=0; m<60; m+=stepMin){
        if(h===endHour && m>0) break;
        times.push([h,m]);
      }
    }
    const days = Array.from({length:7},(_,i)=>addDays(ws,i));
    // 各日の満枠セットをまとめて取得
const takenMap = {};
for (const d of days) takenMap[ymdOf(d)] = await fetchTakenSlots(salonId, ymdOf(d));

    const table = document.createElement('table');
    const thead=document.createElement('thead'), tbody=document.createElement('tbody');

    const hr=document.createElement('tr');
    const corner=document.createElement('th'); corner.style.width='70px'; hr.appendChild(corner);
    days.forEach(d=>{
      const th=document.createElement('th');
      th.style.padding='8px'; th.textContent = d.toLocaleDateString(undefined,{month:'short',day:'numeric',weekday:'short'});
      hr.appendChild(th);
    });
    thead.appendChild(hr);

    // 既に: const table, thead, tbody, hr はできている前提

times.forEach(([h,m])=>{
  const tr = document.createElement('tr');
  const th = document.createElement('th');
  th.textContent = fmtHm(h,m);
  th.style.padding = '6px 8px';
  tr.appendChild(th);

  days.forEach(d=>{
    const td  = document.createElement('td');
    const btn = document.createElement('button');
    btn.className = 'timebtn';

    const slot = hhmm(h,m);        // '09:30' など
    const y    = ymdOf(d);         // '2025-09-24' など
    const isTaken = takenMap[y] && takenMap[y].has(slot);

    if (isTaken) {
      btn.textContent = '×';
      btn.disabled = true;
      btn.setAttribute('aria-disabled','true');
    } else {
      btn.textContent = '◯';
      btn.addEventListener('click', ()=>{
        const dt = new Date(d);
        dt.setHours(h, m, 0, 0);
        const iso = dt.toISOString();
        try { localStorage.setItem('reserve_selected', iso); } catch(_){}
        document.getElementById('v_date').textContent = dt.toLocaleString();
        btn.textContent = '✓';
        setTimeout(()=>btn.textContent='◯', 600);
      });
    }

    td.appendChild(btn);
    tr.appendChild(td);
  });

  tbody.appendChild(tr);
});

table.appendChild(thead);
table.appendChild(tbody);
grid.innerHTML = '';
grid.appendChild(table);


  buildWeek(weekOffset);
  btnPrev.addEventListener('click', ()=>{ weekOffset--; buildWeek(weekOffset); });
  btnNext.addEventListener('click', ()=>{ weekOffset++; buildWeek(weekOffset); });
})();
</script>
 <script>
(function(){
  const footer = document.querySelector('footer');
  if(!footer) return;

  const dlg   = document.getElementById('blModal');
  const frame = document.getElementById('blModalFrame');
  const title = dlg?.querySelector('.title');
  const btnX  = dlg?.querySelector('button.close');

  // フッター内リンクのクリックを横取りしてモーダルで表示
  footer.addEventListener('click', (ev)=>{
    const a = ev.target.closest('a');
    if(!a) return;
    // 同一ページ内のフッターリンクのみを対象
    const href = a.getAttribute('href');
    if(!href || !/\.html?$/i.test(href)) return; // 外部や#などはスルー
    ev.preventDefault();

    if(title) title.textContent = a.textContent.trim() || 'Info';
    if(frame) frame.src = href;

    // 表示
    if(typeof dlg?.showModal === 'function') dlg.showModal();

    // 読み込み後にタイトルをページタイトルへ更新（任意）
    frame?.addEventListener('load', ()=>{
      try{
        const doc = frame.contentDocument || frame.contentWindow?.document;
        const t = doc?.title?.trim();
        if(t && title) title.textContent = t;
      }catch(_e){}
    }, { once:true });
  });

  // 閉じる
  btnX?.addEventListener('click', ()=> dlg?.close());
  dlg?.addEventListener('close', ()=> { if(frame) frame.src='about:blank'; });
})();
</script>
 <!-- decorative background (purely visual) -->
<div class="bg-radials"></div>
<div class="grain"></div>


</body>
</html>
